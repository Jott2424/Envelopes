{% import "nav_macros.html" as nav %}
{% extends "base.html" %}

{% block title %}Create Envelope{% endblock %}

{% block content %}
<div class="home-container">

    <!-- Top navigation -->
    <div class="header-links">
        {{ nav.envelopes_home(budget_id) }}
        {{ nav.home() }}
        {{ nav.logout() }}
    </div>

    <div class="card">
        <h1>Create an Envelope</h1>

        <form method="POST" id="envelope-form">

            <!-- Envelope Name -->
            <div class="form-group">
                <label for="Name">Envelope Name</label>
                <input
                    type="text"
                    id="Name"
                    name="envelope_name"
                    required
                >
            </div>

            <hr>

            <!-- Always Tracked -->
            <h3>Always Tracked (Automatically)</h3>

            <div class="tracker-row disabled">
                <input type="text" value="Date" disabled>
                <select disabled><option>Date</option></select>
                <label><input type="checkbox" checked disabled> Required</label>
            </div>

            <div class="tracker-row disabled">
                <input type="text" value="Merchant" disabled>
                <select disabled><option>Text</option></select>
                <label><input type="checkbox" checked disabled> Required</label>
            </div>

            <div class="tracker-row disabled">
                <input type="text" value="Amount" disabled>
                <select disabled><option>Numeric(10,2)</option></select>
                <label><input type="checkbox" checked disabled> Required</label>
            </div>

            <div class="tracker-row disabled">
                <input type="text" value="Description" disabled>
                <select disabled><option>Text</option></select>
                <label><input type="checkbox" disabled> Optional</label>
            </div>

            <!-- Hidden inserts -->
            <input type="hidden" name="trackers[]" value="amount">
            <input type="hidden" name="types[]" value="numeric(10,2)">
            <input type="hidden" name="required[]" value="0">

            <input type="hidden" name="trackers[]" value="description">
            <input type="hidden" name="types[]" value="text">
            <input type="hidden" name="required[]" value="0">

            <hr>

            <!-- Optional fields -->
            <h3>Additional Envelope-Specific Data</h3>
            <p class="form-hint">
                Add extra fields for this envelope, or leave empty.
            </p>

            <div id="trackers-container"></div>

            <div class="btn-group">
                <button type="button" class="btn secondary-btn" id="add-tracker">
                    + Add Field
                </button>

                <button type="submit" class="btn submit-btn">
                    Create Envelope
                </button>
            </div>

        </form>
    </div>

</div>

<script>
let trackerCount = 0;

document.getElementById("add-tracker").addEventListener("click", function () {
    trackerCount++;

    const container = document.getElementById("trackers-container");
    const div = document.createElement("div");

    div.classList.add("tracker-row");

    div.innerHTML = `
        <input type="text" name="trackers[]" placeholder="Field name">
        <select name="types[]">
            <option value="text">Text</option>
            <option value="numeric(10,2)">Numeric(10,2)</option>
            <option value="date">Date</option>
        </select>
        <label>
            <input type="checkbox" name="required[]" value="${trackerCount}">
            Required
        </label>
        <button type="button" class="remove-btn">â€“</button>
    `;

    container.appendChild(div);
});

document.addEventListener("click", function (e) {
    if (e.target.classList.contains("remove-btn")) {
        e.target.closest(".tracker-row").remove();
    }
});
</script>
{% endblock %}
