{% import "nav_macros.html" as nav %}
{% block content %}

<h1>Ledger Overview</h1>

<div>
    <form method="get">
        Year:
        <select name="year" onchange="this.form.submit()">
            {% for y in range(current_year-5, current_year+1) %}
                <option value="{{ y }}" {% if y==year %}selected{% endif %}>{{ y }}</option>
            {% endfor %}
        </select>

        Month:
        <select name="month" onchange="this.form.submit()">
            {% for m in range(1,13) %}
                <option value="{{ m }}" {% if m==month %}selected{% endif %}>{{ m }}</option>
            {% endfor %}
        </select>
    </form>
</div>

{% for week, env_data in ledger.items() %}
    {% set week_start, week_end = week.split(' - ') %}
    <h3>
        {{ week }}
        <!-- View link -->
        <a href="{{ url_for('receipts_view_route', budget_id=budget_id) }}?start_date={{ week_start }}&end_date={{ week_end }}"
           style="font-size:0.8em; margin-left:10px;">[View]</a>
    </h3>

    <table border="1" cellpadding="6" style="border-collapse:collapse; width:100%; margin-bottom:20px;">
        <thead>
            <tr>
                <th>Type</th>
                {% for eid, name in envelopes.items() %}
                    <th>{{ name }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Deposits</td>
                {% for eid in envelopes.keys() %}
                    <td>{{ env_data.get(eid, {}).credit or 0 }}</td>
                {% endfor %}
            </tr>
            <tr>
                <td>Withdrawals</td>
                {% for eid in envelopes.keys() %}
                    <td>{{ env_data.get(eid, {}).debit or 0 }}</td>
                {% endfor %}
            </tr>
            <tr>
                <td>Running Total</td>
                {% for eid in envelopes.keys() %}
                    <td>{{ env_data.get(eid, {}).running_total or 0 }}</td>
                {% endfor %}
            </tr>
        </tbody>
    </table>
{% endfor %}

<div class="btn-group2">
    {{ nav.budgets_home(budget_id) }}
</div>

{% endblock %}
