{% import "nav_macros.html" as nav %}
{% block content %}

<h1>Create An Envelope</h1>

<div class="container">
    <form method="POST" id="envelope-form">

        <!-- Envelope Name -->
        <label for="Name">Envelope Name</label>
        <textarea
            id="Name"
            name="envelope_name"
            rows="1"
            required
        ></textarea>

        <hr>

        <!-- ========================= -->
        <!-- Always Tracked Fields -->
        <!-- ========================= -->

        <h3>Always Tracked (Automatically)</h3>

        <!-- DATE -->
        <div class="tracker-row" style="opacity:0.6; display:flex; gap:10px; margin-bottom:10px;">
            <input type="text" value="Date" disabled style="width:200px;">
            <select disabled><option>Date</option></select>
            <label><input type="checkbox" checked disabled> Required</label>
        </div>

        <!-- MERCHANT -->
        <div class="tracker-row" style="opacity:0.6; display:flex; gap:10px; margin-bottom:10px;">
            <input type="text" value="Merchant" disabled style="width:200px;">
            <select disabled><option>Text</option></select>
            <label><input type="checkbox" checked disabled> Required</label>
        </div>

        <!-- AMOUNT -->
        <div class="tracker-row" style="opacity:0.6; display:flex; gap:10px; margin-bottom:10px;">
            <input type="text" value="Amount" disabled style="width:200px;">
            <select disabled><option>Numeric(10,2)</option></select>
            <label><input type="checkbox" checked disabled> Required</label>
        </div>

        <!-- DESCRIPTION -->
        <div class="tracker-row" style="opacity:0.6; display:flex; gap:10px; margin-bottom:10px;">
            <input type="text" value="Description" disabled style="width:200px;">
            <select disabled><option>Text</option></select>
            <label><input type="checkbox" disabled> Optional</label>
        </div>

        <!-- Hidden inserts for system fields -->
        <input type="hidden" name="trackers[]" value="amount">
        <input type="hidden" name="types[]" value="numeric(10,2)">
        <input type="hidden" name="required[]" value="0">

        <input type="hidden" name="trackers[]" value="description">
        <input type="hidden" name="types[]" value="text">
        <input type="hidden" name="required[]" value="0">

        <hr>

        <!-- ========================= -->
        <!-- Optional Fields -->
        <!-- ========================= -->

        <h3>Additional Envelope-Specific Data (Optional)</h3>
        <p style="font-size:0.9em; opacity:0.7;">
            Add extra fields for this envelope, or leave empty.
        </p>

        <div id="trackers-container"></div>

        <button type="button" id="add-tracker">+ Add Field</button>
        <br><br>
        <button type="submit">Create Envelope</button>
    </form>
</div>

<script>
let trackerCount = 0;

document.getElementById("add-tracker").addEventListener("click", function () {
    trackerCount++;

    const container = document.getElementById("trackers-container");
    const div = document.createElement("div");

    div.classList.add("tracker-row");
    div.style = "margin-bottom:10px; display:flex; gap:10px; align-items:center;";

    div.innerHTML = `
        <input type="text" name="trackers[]" placeholder="Field name" style="width:200px;">
        <select name="types[]">
            <option value="text">Text</option>
            <option value="numeric(10,2)">Numeric(10,2)</option>
            <option value="date">Date</option>
        </select>
        <label>
            <input type="checkbox" name="required[]" value="${trackerCount}">
            Required
        </label>
        <button type="button" class="remove-tracker">â€“</button>
    `;

    container.appendChild(div);
});

document.addEventListener("click", function (e) {
    if (e.target.classList.contains("remove-tracker")) {
        e.target.closest(".tracker-row").remove();
    }
});
</script>

<div class="btn-group2">
    {{ nav.envelopes_home(budget_id) }}
</div>

{% endblock %}
