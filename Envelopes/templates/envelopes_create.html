{% import "nav_macros.html" as nav %}
{% block content %}

<h1>Create An Envelope</h1>

<div class="container">
    <form method="POST" id="envelope-form">

        <label for="Name">Envelope Name</label>
        <textarea id="Name" name="envelope_name" rows="1" required></textarea>

        <hr>

        <h3>Always Tracked (Automatically)</h3>

        <!-- DATE (display only) -->
        <div class="tracker-row" style="margin-bottom:10px; display:flex; gap:10px; align-items:center; opacity:0.6;">
            <input type="text" value="Date" style="width:200px;" disabled>
            <select disabled>
                <option>Date</option>
            </select>
            <label>
                <input type="checkbox" checked disabled>
                Required
            </label>
        </div>

        <!-- MERCHANT (display only) -->
        <div class="tracker-row" style="margin-bottom:10px; display:flex; gap:10px; align-items:center; opacity:0.6;">
            <input type="text" value="Merchant" style="width:200px;" disabled>
            <select disabled>
                <option>Text</option>
            </select>
            <label>
                <input type="checkbox" checked disabled>
                Required
            </label>
        </div>

        <!-- AMOUNT (display + hidden submit) -->
        <div class="tracker-row" style="margin-bottom:10px; display:flex; gap:10px; align-items:center; opacity:0.6;">
            <input type="text" value="Amount" style="width:200px;" disabled>
            <select disabled>
                <option>Numeric(10,2)</option>
            </select>
            <label>
                <input type="checkbox" checked disabled>
                Required
            </label>
        </div>

        <!-- DESCRIPTION (display only) -->
        <div class="tracker-row" style="margin-bottom:10px; display:flex; gap:10px; align-items:center; opacity:0.6;">
            <input type="text" value="Description" style="width:200px;" disabled>
            <select disabled>
                <option>Text</option>
            </select>
            <label>
                <input type="checkbox" disabled>
                Optional
            </label>
        </div>

        <!-- Hidden inputs so AMOUNT IS ACTUALLY INSERTED -->
        <input type="hidden" name="trackers[]" value="amount">
        <input type="hidden" name="types[]" value="numeric(10,2)">
        <input type="hidden" name="required[]" value="0">

        <!-- Hidden inputs so DESCRIPTION IS ACTUALLY INSERTED -->
        <input type="hidden" name="trackers[]" value="description">
        <input type="hidden" name="types[]" value="text">
        <input type="hidden" name="required[]" value="0">

        <hr>

        <h3>Additional Envelope-Specific Data</h3>

        <div id="trackers-container">
            <!-- First editable tracker row -->
            <div class="tracker-row" style="margin-bottom:10px; display:flex; gap:10px; align-items:center;">
                <input type="text" name="trackers[]" placeholder="Tracker 1" style="width:200px;" required>
                <select name="types[]">
                    <option value="text">Text</option>
                    <option value="numeric(10,2)">Numeric(10,2)</option>
                    <option value="date">Date</option>
                </select>
                <label>
                    <input type="checkbox" name="required[]" value="1">
                    Required
                </label>
            </div>
        </div>

        <button type="button" id="add-tracker">+ Add Another</button>
        <button type="submit">Create Envelope</button>
    </form>
</div>

<script>
let trackerCount = 1;

document.getElementById("add-tracker").addEventListener("click", function() {
    trackerCount += 1;
    const container = document.getElementById("trackers-container");

    const div = document.createElement("div");
    div.classList.add("tracker-row");
    div.style = "margin-bottom:10px; display:flex; gap:10px; align-items:center;";

    div.innerHTML = `
        <input type="text" name="trackers[]" placeholder="Tracker ${trackerCount}" style="width:200px;" required>
        <select name="types[]">
            <option value="text">Text</option>
            <option value="numeric(10,2)">Numeric(10,2)</option>
            <option value="date">Date</option>
        </select>
        <label>
            <input type="checkbox" name="required[]" value="${trackerCount}">
            Required
        </label>
    `;

    container.appendChild(div);
});
</script>

<div class="btn-group2">
  {{ nav.envelopes_home(budget_id) }}
</div>

{% endblock %}
